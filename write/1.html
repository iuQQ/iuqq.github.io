<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>发布文章</title>
  </head>
  <style type="text/css" media="all">
     .action{
         display: block;
     }
  
     .s{
         width: 100%;
         height: 100%;
         position: absolute;
         background-color: white;
         display: none;
     } 
  </style>
  <body>
    <div class="s">
        提交中，请耐心等待
    </div>
    标题：<input id="u" type="text"/><br />
    内容：<input id="p" type="text"/><br />
    <button onclick="dian()" type="submit">提交</button>
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>  
    <script src="https://unpkg.com/vconsole@3.15.0/dist/vconsole.min.js" type="text/javascript" charset="utf-8"></script>
    <script>
    var vConsole = new VConsole();
    </script>
    <script type="text/javascript" charset="utf-8">
            qw = document.location.search
            qe = qw.substring(1)
            console.log(qe)
            if (qw != ""){
                qr = qe[1].split("&")
                console.log(qr)
                qt = qr[2].split("=")
                console.log(qt)
                qy = qt[1]
            }else{
                qy = "apdxucehwxkf13socjwhfi"
            }

    $.ajax({
        url:"http://service.kefantx.com:88/hxd/checkToken",
        method:"post",
        data:{
        appId:"54340",
        tokenId:qy
      },
        success: function(res){
        console.log(res.code)
        if (res.code == 500){
            window.alert("token值无效，即将跳转登录")
            window.open("http://hxd.kefantx.com/#/pages/login/login?appId=54340&appName=000")
			token = false
        }else{
            window.alert("token值有效")
			token = true
			id = res.datas[0].USERID
			console.log(res)
		//这一段代码因未知原因未执行导致id变量未创建会导致出现错误
        }
       }
      })
    </script>
    <script>
    function dian(){
    $("div").addClass("action")
    u = document.getElementById("u").value
    p = document.getElementById("p").value
    $.ajax({
      url:"http://service.kefantx.com:88/hxd/insertPublicNormalTable",
      method:"post",
      data:{
        appId:"54340",
        appKey:"af126aec3fff4e48bbcdd76cbfc9cf85",
        userId:id,
        String1:u,
        String2:p
      },
      success: function(res){
          console.log(res)
          document.write('发布成功<br>')
          document.write('3秒后跳转到首页')
          function jumurl(){
　    　window.location.href = '../index.html';
　    　}
　　    setTimeout(jumurl,3000);
          }
      })

    }
        </script>
  </body>
</html>